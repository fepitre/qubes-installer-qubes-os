From 1cb7842dbd5ec6cb2a59016b4c1b73e6b51ee395 Mon Sep 17 00:00:00 2001
From: "Frederic Pierret (Epitre)" <frederic.epitre@orange.fr>
Date: Tue, 19 Sep 2017 17:07:29 +0200
Subject: [PATCH 12/31] anaconda: Do not fail during initramfs start-up due to
 missing url-lib

---
 dracut/anaconda-ks-sendheaders.sh | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/dracut/anaconda-ks-sendheaders.sh b/dracut/anaconda-ks-sendheaders.sh
index 7bc9739..39fa0ce 100755
--- a/dracut/anaconda-ks-sendheaders.sh
+++ b/dracut/anaconda-ks-sendheaders.sh
@@ -2,7 +2,15 @@
 # anaconda-ks-sendheaders.sh - set various HTTP headers for kickstarting
 
 [ -f /tmp/.ks_sendheaders ] && return
-command -v set_http_header >/dev/null || . /lib/url-lib.sh
+
+if ! command -v set_http_header >/dev/null; then
+    if ! [ -r /lib/url-lib.sh ]; then
+        alias set_http_header=:
+        return
+    fi
+
+    . /lib/url-lib.sh
+fi
 
 # inst.ks.sendmac: send MAC addresses in HTTP headers
 if getargbool 0 kssendmac inst.ks.sendmac; then
-- 
2.9.5

