From 3f1579472901c84808b1379b7bd10a84b4948458 Mon Sep 17 00:00:00 2001
From: "Frederic Pierret (Epitre)" <frederic.epitre@orange.fr>
Date: Tue, 19 Sep 2017 18:26:07 +0200
Subject: [PATCH 16/30] anaconda: Make sure that a user is created at
 installation time

---
 pyanaconda/ui/gui/spokes/user.py | 8 ++------
 pyanaconda/ui/tui/spokes/user.py | 7 +------
 2 files changed, 3 insertions(+), 12 deletions(-)

diff --git a/pyanaconda/ui/gui/spokes/user.py b/pyanaconda/ui/gui/spokes/user.py
index f85dd6c..2a9012d 100644
--- a/pyanaconda/ui/gui/spokes/user.py
+++ b/pyanaconda/ui/gui/spokes/user.py
@@ -26,7 +26,6 @@ from pyanaconda.users import cryptPassword, guess_username, check_username
 from pyanaconda.ui.gui.spokes import NormalSpoke
 from pyanaconda.ui.gui import GUIObject
 from pyanaconda.ui.categories.user_settings import UserSettingsCategory
-from pyanaconda.ui.common import FirstbootSpokeMixIn
 from pyanaconda.ui.helpers import InputCheck
 from pyanaconda.ui.gui.helpers import GUISpokeInputCheckHandler, GUIDialogInputCheckHandler
 from pyanaconda.ui.gui.utils import blockedHandler, set_password_visibility
@@ -208,7 +207,7 @@ class AdvancedUserDialog(GUIObject, GUIDialogInputCheckHandler):
 
         return False
 
-class UserSpoke(FirstbootSpokeMixIn, NormalSpoke, GUISpokeInputCheckHandler):
+class UserSpoke(NormalSpoke, GUISpokeInputCheckHandler):
     """
        .. inheritance-diagram:: UserSpoke
           :parts: 3
@@ -360,10 +359,7 @@ class UserSpoke(FirstbootSpokeMixIn, NormalSpoke, GUISpokeInputCheckHandler):
 
     @property
     def mandatory(self):
-        """ Only mandatory if the root pw hasn't been set in the UI
-            eg. not mandatory if the root account was locked in a kickstart
-        """
-        return not self.data.rootpw.password and not self.data.rootpw.lock
+        return True
 
     def apply(self):
         # set the password only if the user enters anything to the text entry
diff --git a/pyanaconda/ui/tui/spokes/user.py b/pyanaconda/ui/tui/spokes/user.py
index 7f4a0cd..fa5cf9e 100644
--- a/pyanaconda/ui/tui/spokes/user.py
+++ b/pyanaconda/ui/tui/spokes/user.py
@@ -20,7 +20,6 @@
 from pyanaconda.ui.categories.user_settings import UserSettingsCategory
 from pyanaconda.ui.tui.spokes import EditTUISpoke
 from pyanaconda.ui.tui.spokes import EditTUISpokeEntry as Entry
-from pyanaconda.ui.common import FirstbootSpokeMixIn
 from pyanaconda.users import guess_username, check_username
 from pyanaconda.flags import flags
 from pyanaconda.i18n import N_, _
@@ -65,7 +64,6 @@ class UserSpoke(FirstbootSpokeMixIn, EditTUISpoke):
             return False
 
     def __init__(self, app, data, storage, payload, instclass):
-        FirstbootSpokeMixIn.__init__(self)
         EditTUISpoke.__init__(self, app, data, storage, payload, instclass, "user")
         self.initialize_start()
         if self.data.user.userList:
@@ -112,10 +110,7 @@ class UserSpoke(FirstbootSpokeMixIn, EditTUISpoke):
 
     @property
     def mandatory(self):
-        """ Only mandatory if the root pw hasn't been set in the UI
-            eg. not mandatory if the root account was locked in a kickstart
-        """
-        return not self.data.rootpw.password and not self.data.rootpw.lock
+        return True
 
     @property
     def status(self):
-- 
2.9.5

